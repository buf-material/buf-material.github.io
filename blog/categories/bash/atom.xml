<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Bash | My Octopress Blog]]></title>
  <link href="http://yoursite.com/blog/categories/bash/atom.xml" rel="self"/>
  <link href="http://yoursite.com/"/>
  <updated>2014-12-13T15:27:01+09:00</updated>
  <id>http://yoursite.com/</id>
  <author>
    <name><![CDATA[Your Name]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Bashシェルの変数にデフォルト値を設定する]]></title>
    <link href="http://yoursite.com/blog/2014/10/11/set-default-value-to-bash-variables/"/>
    <updated>2014-10-11T10:25:18+09:00</updated>
    <id>http://yoursite.com/blog/2014/10/11/set-default-value-to-bash-variables</id>
    <content type="html"><![CDATA[<h2>変数に値が未セットの場合にのみ任意の文字を代入したい</h2>

<p>bashシェルのスクリプトの中で特定の変数に値がセットされていない場合はデフォルト値を代入するということがあります。そこで、変数に値が未セットの場合にのみ特定の値をデフォルト値として代入することができます。</p>

<p>bashには様々な変数の参照方法があるんですが、<code>${変数名:=値}</code>と書くことで、<strong>値がセット済みの場合にはその値を返し、未セットの場合には任意の値を返す</strong>という動作をします。</p>

<h3>1. インタラクティブなシェル上で変数を定義</h3>

<p>例えば、<code>$var</code>変数に<code>hello</code>という値を代入しておき、上記の書き方で値を参照してみます。</p>

<pre><code class="sh">$ var="hello"

$ echo ${var:="goog morning"}
hello
</code></pre>

<p><code>$var</code>変数を空にして<code>goog morning</code>という値を代入してみたいとしましょう。</p>

<pre><code class="sh">$ var=

$ echo ${var:="goog morning"}
goog morning

$ echo $var
goog morning
</code></pre>

<p><code>${変数名:=値}</code>という書き方をした場合、返り値としてセットした(あるいはセットされている)<code>値</code>を返します。その返り値を<code>echo</code>でprintしています。</p>

<p>では、<code>echo</code>させずに<code>${変数名:=値}</code>だけを実行するとどうでしょう。</p>

<pre><code class="sh">$ var=

$ ${var:="goog morning"}
-bash: goog morning: コマンドが見つかりません

$ echo $var
goog morning
</code></pre>

<p>シェルは返り値をコマンドとして認識するのですが、<code>goog morning</code>などというコマンドは存在しないのでメッセージが出力されます。しかし、<code>$var</code>変数への値のセットは成功したようです。</p>

<p><code>echo</code>を使わずに、かつメッセージも出力させないためには以下のように、何もしないという<code>コロン(:)</code>を使う方法があります。</p>

<pre><code class="sh">$ var=

$ : ${var:="goog morning"}

$ echo $var
goog morning
</code></pre>

<h3>2. シェルスクリプト内の変数値にtrue/falseを使用する場合の注意点</h3>

<p>シェルスクリプトで<code>set -e</code>を先頭に書いておくことで、スクリプト内のコマンドが失敗を返した場合にはスクリプトを終了させることが出来ます。おまじないのように書いていることがありますが、変数の値にに<code>true/false</code>を使用している場合には注意が必要です。</p>

<p><code>true</code>や<code>false</code>はbashシェルの組み込みコマンドとして存在し、その名の通り、<code>true</code>は真を返し、<code>false</code>は偽を返します。なので、<code>${var:=false}</code>などと書いているとこの変数定義の行の実行結果は偽を返すことになります。</p>

<pre><code class="sh">$ var=

$ ${var:="false"}

$ echo $?
1
</code></pre>

<p>シェルスクリプトで<code>set -e</code>としている場合にはそこでスクリプトが終了してしまい、期待通りに動かない可能性があります。ここでも何もしないという<code>コロン(:)</code>を使用するという方法が有効です。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Bashで読み込み専用変数を定義する]]></title>
    <link href="http://yoursite.com/blog/2014/10/10/set-constant-variables-for-bash/"/>
    <updated>2014-10-10T08:44:05+09:00</updated>
    <id>http://yoursite.com/blog/2014/10/10/set-constant-variables-for-bash</id>
    <content type="html"><![CDATA[<h2>bash変数を読み込み専用として定義する</h2>

<p>bashのビルトインコマンドとして<code>typeset</code>と<code>declare</code>という変数定義に関するコマンドがあります。<code>declare</code>コマンドの<code>-r</code>オプションを使用して定義した変数は読み込み専用となり、以降の変数への値代入が出来なくなります。</p>

<p>試しに、<code>hello</code>という文字列を代入した<code>CONSTANT_VAR</code>という変数を読み込み専用として定義してみます。</p>

<pre><code class="sh">$ declare -r CONSTANT_VAR='hello'

$ echo ${CONSTANT_VAR}
hello
</code></pre>

<p>この<code>CONSTANT_VAR</code>変数に新しい値を代入しようと試みたら以下のようなメッセージが出力され変数への代入が失敗します。</p>

<pre><code class="sh">$ CONSTANT_VAR="goot morning"
-bash: CONSTANT_VAR: 読み込みのみの変数

$ echo ${CONSTANT_VAR}
hello
</code></pre>
]]></content>
  </entry>
  
</feed>
